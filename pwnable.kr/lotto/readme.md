I was too fixated on the brute force aspect of this, that I didn't even expect to look for a bug in the comparison code. 
It should have tipped me off that this was a large aspect of the code.