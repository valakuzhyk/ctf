from pwn import *

context.log_level = 'debug'

# stage 1

arg_list = ['/home/input2/input'] + ["a"] * 99
arg_list[ord('A')] = "\x00"
arg_list[ord('B')] = "\x20\x0a\x0d"
arg_list[ord('C')] = "1234" 

# stage 4
f = open('\x0a', 'w+')
f.write('\x00'*4)
f.close()

# conn = ssh('input','pwnable.kr', 2222, 'guest')
# r = conn.process(['./input'])

stderr_r, stderr_w = os.pipe()
r = process(arg_list, stderr=stderr_r, env={'\xde\xad\xbe\xef':'\xca\xfe\xba\xbe'} ) # Stage 3



# stage 2
r.sendline("\x00\x0a\x00\xff")
os.write(stderr_w, "\x00\x0a\x02\xff")

socket = remote('127.0.0.1', 1234)
socket.send("\xde\xad\xbe\xef")
socket.close()


print r.recvall()


os.close(stderr_r)
os.close(stderr_w)
